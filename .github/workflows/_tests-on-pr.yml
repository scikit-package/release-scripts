name: Tests on PR

on:
  workflow_call:
    inputs:
      project:
        description: 'Name of the project to test'
        default: 'PROJECT_NAME'
        required: false
        type: string
      python_version:
        description: 'Python version for Conda environment'
        default: 3.13
        required: false
        type: number
      c_extension:
        description: 'Whether the project has a C extension'
        default: false
        required: false
        type: boolean
      headless:
        description: 'Whether to run headless tests'
        default: false
        required: false
        type: boolean
      run:
        description: 'Extra CLI commands to run after installing the project'
        default: 'echo "No extra commands"'
        required: false
        type: string
    secrets:
      CODECOV_TOKEN:
        description: 'Codecov token'
        required: true

jobs:
  run-tests:
    uses: scikit-package/release-scripts/.github/workflows/_tests-on-pr-no-codecov.yml@v0
    with:
      project: ${{ inputs.project }}
      python_version: ${{ inputs.python_version }}
      c_extension: ${{ inputs.c_extension }}
      headless: ${{ inputs.headless }}
      run: ${{ inputs.run }}

  upload-codecov:
    needs: [run-tests]
    uses: scikit-package/release-scripts/.github/workflows/_upload-to-codecov.yml@v0
    secrets:
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
