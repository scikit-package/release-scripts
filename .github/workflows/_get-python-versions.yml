name: Get Python Versions

on:
  workflow_call:
    inputs:
      python_versions:
        description: 'Comma-separated list of Python versions. If not provided, versions will be read from pyproject.toml'
        default: ""
        required: false
        type: string
    outputs:
      python_versions:
        description: 'Comma-separated list of Python versions'
        value: ${{ jobs.get-versions.outputs.python_versions }}

jobs:
  get-versions:
    runs-on: ubuntu-latest
    outputs:
      python_versions: ${{ steps.set-versions.outputs.python_versions }}
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Extract Python versions from pyproject.toml
        id: set-versions
        run: |
          if [ -n "${{ inputs.python_versions }}" ]; then
            # Use user-provided versions if specified
            VERSIONS="${{ inputs.python_versions }}"
            echo "Using user-provided Python versions: $VERSIONS"
          else
            # Extract versions from pyproject.toml classifiers
            if [ -f "pyproject.toml" ]; then
              # Extract Python version classifiers (e.g., "Programming Language :: Python :: 3.12")
              VERSIONS=$(grep -oP "Programming Language :: Python :: \K3\.\d+" pyproject.toml | sort -V | tr '\n' ',' | sed 's/,$//')
              
              if [ -z "$VERSIONS" ]; then
                echo "Warning: No Python version classifiers found in pyproject.toml"
                # Fallback to default versions
                VERSIONS="3.12, 3.13, 3.14"
                echo "Using fallback versions: $VERSIONS"
              else
                echo "Extracted Python versions from pyproject.toml: $VERSIONS"
              fi
            else
              echo "Warning: pyproject.toml not found"
              # Fallback to default versions
              VERSIONS="3.12, 3.13, 3.14"
              echo "Using fallback versions: $VERSIONS"
            fi
          fi
          echo "python_versions=$VERSIONS" >> $GITHUB_OUTPUT
